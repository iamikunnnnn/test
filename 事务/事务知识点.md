# 1.事务（Transaction）——数据库的"原子操作"
1. 事务的基本概念
什么是事务？
事务是数据库操作的最小工作单元，是作为一个整体执行的一系列操作，要么全部执行成功，要么全部失败回滚。

经典例子：银行转账
-- A向B转账100元

``
UPDATE accounts SET balance = balance - 100 WHERE id = 'A';
UPDATE accounts SET balance = balance + 100 WHERE id = 'B';
``
这两个操作必须作为一个整体执行！

# 2. 事务的四大特性（ACID）
| 特性              | 说明            | 生活比喻                     |
|-----------------|---------------|--------------------------|
| Atomicity 原子性   | 事务是不可分割的      | 工作单位要么全做，要么全不做，像原子一样不可分割 |
| Consistency 一致性 | 事务执行前后数据库状态一致 | 转账前后总金额不变                |
| Isolation 隔离性   | 并发事务间互不干扰     | 多人同时转账互不影响               |
| Durability 持久性  | 事务提交后永久有效     | 转账成功后结果永久保存              |

# 3. 事务控制语句
(见 事务.sql)

# 4. 事务隔离级别*

| 隔离级别       | 脏读 | 不可重复读 | 幻读 | 性能 |
|----------------|------|------------|------|------|
| READ UNCOMMITTED | ✓    | ✓          | ✓    | 最高 |
| READ COMMITTED   | ×    | ✓          | ✓    | 高   |
| REPEATABLE READ  | ×    | ×          | ✓    | 中   |
| SERIALIZABLE     | ×    | ×          | ×    | 最低 |

# 5 锁机制（重要）

(如果没有锁,万一在几乎同一时间内两个事务同时触发并导致冲突会出问题,锁机制就是保证这个事务需要操作的行,在事务结束前不会有别的事务进行同时操作)
假如说一个购物事务
在刚开始需要索引库存,判断库存还有没有货,此时在索引库存时就要给这一行上一个锁,使在这个事件完成之前,其他事件不能对这一行进行修改

使用FOR UPDATE来添加(排他)锁.
FOR UPDATE 会在查询的行上放置排他锁，防止其他事务对这些行进行更新或删除操作。在提交或回滚后才会解锁排他锁

例:
SELECT products.stock FROM products WHERE product_id =1 FOR UPDATE ;

----
事务使用建议*：
- 尽量缩短事务持续时间
- 避免在事务中进行用户交互
- 合理设置隔离级别
